<h2 mat-dialog-title>{{ "accounts.entryDialog.title" | translate }}</h2>
<mat-dialog-content [formGroup]="entryForm" class="dialog-content" *ngIf="loaded(); else loading">
  <div class="entry-date" formGroupName="movementDate">
    <mat-form-field floatLabel="always">
      <mat-label translate="accounts.entryDialog.fields.entryDate.title"></mat-label>
      <input
        matInput
        [matDatepicker]="entryDatePicker"
        autocomplete="off"
        formControlName="date"
        placeholder="{{ this.entryForm.controls.movementDate.value.date | date: 'shortDate' }}"
      />
      <mat-error *ngIf="getEntryDateError() as errorCode">{{ errorCode | translate }}</mat-error>
      <mat-datepicker-toggle matSuffix [for]="entryDatePicker"></mat-datepicker-toggle>
      <mat-datepicker #entryDatePicker></mat-datepicker>
    </mat-form-field>
    <mat-form-field *ngIf="(extendedDate() || extendedDateToggleGroup.value) === 'extended-date'" floatLabel="always">
      <mat-label translate="accounts.entryDialog.fields.bookingDate.title"></mat-label>
      <input
        matInput
        [matDatepicker]="bookingDatePicker"
        autocomplete="off"
        formControlName="bookingDate"
        placeholder="{{ this.entryForm.controls.movementDate.value.date | date: 'shortDate' }}"
      />
      <mat-datepicker-toggle matSuffix [for]="bookingDatePicker"></mat-datepicker-toggle>
      <mat-datepicker #bookingDatePicker></mat-datepicker>
    </mat-form-field>
    <mat-form-field *ngIf="(extendedDate() || extendedDateToggleGroup.value) === 'extended-date'" floatLabel="always">
      <mat-label translate="accounts.entryDialog.fields.bookingMonth.title"></mat-label>
      <input
        matInput
        [fmMonthpicker]="budgetPeriodPicker"
        autocomplete="off"
        formControlName="budgetPeriod"
        placeholder="{{ this.entryForm.controls.movementDate.value.date | date: 'MMM YYYY' }}"
      />
      <mat-datepicker-toggle matSuffix [for]="budgetPeriodPicker"></mat-datepicker-toggle>
      <fm-monthpicker #budgetPeriodPicker></fm-monthpicker>
    </mat-form-field>
    <mat-button-toggle-group #extendedDateToggleGroup="matButtonToggleGroup" value="{{ extendedDate }}">
      <mat-button-toggle class="fm-narrow-toggle-button" value="extended-date">
        <mat-icon>{{
          extendedDateToggleGroup.value === "extended-date" ? "keyboard_arrow_left" : "keyboard_arrow_right"
        }}</mat-icon>
      </mat-button-toggle>
    </mat-button-toggle-group>
  </div>
  <div
    *ngIf="
      (extendedEntry() || extendedEntryToggleGroup.value) === 'extended-entry';
      then multipleEntry;
      else singleEntry
    "
  ></div>
  <ng-template #multipleEntry>
    <div class="entries-container">
      <div class="entry-item-list">
        <mat-card
          class="mat-elevation-z2 entry-item-wrapper"
          *ngFor="let entryItem of entryForm.controls.entryItems.controls; let entryItemIndex = index"
          fmFocusHighlight="fm-entry-item-highlighted"
          formArrayName="entryItems"
        >
          <div>{{ entryItemIndex + 1 }}.</div>
          <fm-entry-item [formGroup]="entryItem"></fm-entry-item>
          <button mat-icon-button class="fm-small-button" (click)="deleteEntryItem(entryItemIndex)">
            <mat-icon>clear</mat-icon>
          </button>
        </mat-card>
        <button mat-mini-fab (click)="addEntryItem()" type="button" class="add-entry-item-button">
          <mat-icon>add</mat-icon>
        </button>
      </div>
      <div>
        <div></div>
        <div
          class="mat-body-strong mat-body-2"
          *ngIf="cumulatedSum()"
          [ngClass]="(cumulatedSum() ?? 0) > 0 ? 'positive-amount' : 'negative-amount'"
        >
          {{ cumulatedSum }}
        </div>
      </div>
    </div>
  </ng-template>
  <ng-template #singleEntry>
    <fm-entry-item [formGroup]="entryForm.controls.entryItems.controls[0]"></fm-entry-item>
  </ng-template>
  <mat-button-toggle-group #extendedEntryToggleGroup="matButtonToggleGroup" value="{{ extendedEntry }}">
    <mat-button-toggle value="extended-entry" class="fm-thin-toggle-button">
      <mat-icon>{{
        extendedEntryToggleGroup.value === "extended-entry" ? "keyboard_arrow_up" : "keyboard_arrow_down"
      }}</mat-icon>
    </mat-button-toggle>
  </mat-button-toggle-group>
</mat-dialog-content>
<mat-dialog-actions class="dialog-actions">
  <div class="fm-spacer"></div>
  <button mat-stroked-button color="primary" (click)="save()" [disabled]="!(entryForm.valid && entryForm.dirty)">
    {{ "accounts.entryDialog.buttons.save.title" | translate }}
  </button>
  <button mat-stroked-button (click)="close()">{{ "accounts.entryDialog.buttons.cancel.title" | translate }}</button>
</mat-dialog-actions>
<ng-template #loading> Loading stuff....</ng-template>
